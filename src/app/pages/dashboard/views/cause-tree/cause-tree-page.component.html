<section class="cause-page">
  <header class="page-header">
    <div class="page-header__left">
      <p class="eyebrow">Investigación #{{ investigationId() }}</p>
      <h1>Árbol de Causas</h1>
      <p class="muted">Vista responsiva para desglosar causas raíz. Usa drag para navegar.</p>

      <div class="chips">
        <span class="chip chip--red">Grave</span>
        <span class="chip chip--muted">En progreso</span>
        <span class="chip chip--outline">Zona de Carga · Torre B</span>
      </div>
    </div>

    <div class="page-header__actions">
      <button class="ghost" type="button" (click)="resetTree()" [disabled]="loading()">
        Reiniciar
      </button>
      <button
        class="ai-btn"
        type="button"
        [disabled]="aiStatus() === 'working'"
        (click)="generateAiTree()"
      >
        <span *ngIf="aiStatus() !== 'working'">Generar con IA</span>
        <span *ngIf="aiStatus() === 'working'">Trabajando...</span>
      </button>
      <button class="primary" type="button">Generar PDF</button>
    </div>
  </header>

  <div class="status-bar">
    <div *ngIf="loading()" class="status status--info">Cargando árbol...</div>
    <div *ngIf="error()" class="status status--warn">{{ error() }}</div>
  </div>

  <app-cause-canvas
    [tree]="tree()"
    (addNode)="openAdd($event)"
    (editNode)="openEdit($event)"
  ></app-cause-canvas>

  <app-node-modal
    [open]="modalOpen()"
    [mode]="modalMode()"
    [saving]="saving()"
    [initialText]="editing()?.text || ''"
    [initialType]="editing()?.type || 'Condición'"
    (cancel)="closeModal()"
    (save)="saveNode($event)"
  ></app-node-modal>

  <app-ai-toast
    [title]="aiTitle()"
    message="Correlacionando hechos y generando nodos previos."
    [visible]="aiStatus() === 'working'"
  ></app-ai-toast>
</section>
